---
title: "Abhay_InitialWrangling"
author: "Abhay V Rao"
date: "4/5/2022"
output: html_document
---

```{r setup, include=FALSE}
#Examine the working directory
getwd()

#Import libraries
library(tidyverse)
library(lubridate)
library(sf)
library(mapview)
library(RColorBrewer)
library(cowplot)
```
Reading the shapefile on biogas. Examining its characteristics.

```{r}
biogas_sf<- st_read('../Data/biomethane/Biomethane.shp')
colnames(biogas_sf)

biogas_california_sf<- st_read('../Data/biomethane/Biomethane.shp') %>%
  filter(STATE_NAME == "California")

<<<<<<< HEAD
class(biogas_california_sf$NAME)

=======
>>>>>>> b832c420e6f54d51df1f719b4ecaeda6d0edc077
str(biogas_california_sf)
summary(biogas_california_sf)
st_crs(biogas_california_sf) # WGS 84, EPSG 4326
st_bbox(biogas_california_sf)
head(biogas_california_sf)

```

Preliminary map view and ggplot of methane generation potential from waste water 
treatment in California.

```{r}

mapView(biogas_california_sf, zcol = "TotalCH4t")

Total_ch4_plot <-ggplot(data=biogas_california_sf) +
  geom_sf(aes(fill=TotalCH4t)) + 
  scale_fill_continuous(type='viridis')+
  labs(title='Total CH4 Potential, CA (MT per year)',
  )
print(Total_ch4_plot)
 
WW_ch4_plot <- ggplot(data=biogas_california_sf) +
  geom_sf(aes(fill=WWTPCH4t)) + 
  scale_fill_continuous(type='viridis')+
  labs(title='Wastewater Derived CH4 Potential, CA (MT per year)',
  )
print(WW_ch4_plot)

Landfill_ch4_plot <- ggplot(data=biogas_california_sf) +
  geom_sf(aes(fill=LFGCH4t)) + 
  scale_fill_continuous(type='viridis')+
  labs(title='Landfill Derived CH4 Potential, CA (MT per year)',
  )
print(Landfill_ch4_plot)

OW_ch4_plot <- ggplot(data=biogas_california_sf) +
  geom_sf(aes(fill=OWCH4t)) + 
  scale_fill_continuous(type='viridis')+
  labs(title='Commercial Organic Waste Derived CH4 Potential, CA (MT per year)',
  )
print(OW_ch4_plot)

AM_ch4_plot <- ggplot(data=biogas_california_sf) +
  geom_sf(aes(fill=AMCH4t)) + 
  scale_fill_continuous(type='viridis')+
  labs(title='Animal Manure Derived CH4 Potential, CA (MT per year)',
  )
print(AM_ch4_plot)

 Combinedplot_CH4 <- plot_grid(Total_ch4_plot, WW_ch4_plot, Landfill_ch4_plot, 
                               OW_ch4_plot, AM_ch4_plot)      
  print(Combinedplot_CH4)
  


```

Wrangling the population dataset below:

```{r}
population_data <- read.csv('../Data/CalCountyPopulation/Population2020.csv')
population_data$Population <- as.numeric(gsub(",","",population_data$Population))
class(population_data$Population)
head(population_data)


class(population_data$NAME)

biogas_pop_join <- left_join(biogas_california_sf, population_data, by = c('NAME' = 'NAME'))
str(biogas_pop_join)
head(biogas_pop_join)
str(biogas_pop_sf)
biogas_pop_join$Population <- as.numeric(c("1661584",
"1159","39023","223344","45828","21491","1147788","27692",
"190345","990204","28060", "136101","180580","17930","892458","151090",
"64276","30600","10040682", "155925","259441","17319", "87110","273661","8853",
"14395","432977","138572","99417","3170345","391799","18844","2437864","1537948",
"61547","2162532","3323970","874784","751615","282517","765623","444895","1924379",
"273170","179267","2898","43516","444538","496801","546235","96315","64176",
"1254","463955","54147","845599","218774","77524"
))

mapView(biogas_pop_join, zcol = "Population")

```

Regressions 

```{r}

ggplot(biogas_pop_join,aes(x=Population,y=WWTPCH4t)) + 
  geom_line() + 
  geom_smooth(method=lm,se=FALSE)+
  labs(title='Population and CH4 potential from Wastewater Treatment', 
       subtitle= "California",y="CH4 Generation", 
       x="Population")
```

=======

```

Wrangling the population dataset below:

```{r}
population_sf <- st_read('../Data/2010_Census_Urban_Areas/2010_Census_Urban_Areas.shp')
population_tracts_sf <- st_read('../Data/2010_Census_Tracts/2010_Census_Tracts.shp')

str(population_sf)
summary(population_sf)
st_crs(population_sf) # WGS 84, EPSG 4326
st_bbox(population_sf)
head(population_sf)

```

>>>>>>> b832c420e6f54d51df1f719b4ecaeda6d0edc077
